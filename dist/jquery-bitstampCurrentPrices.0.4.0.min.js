/*!
 * Display the latest Bitstamp Bitcoin prices in your local curreny with jquery-bitstampCurrentPrices - v0.4.0 - 2015-04-11
 * https://github.com/bit-2-bit/bitstamp-current-prices
 * Copyright (c) 2015 Dave Sag; Licensed MIT
 */

(function(){if("function"!=typeof jQuery)throw"Expected jQuery to have been loaded before this script."}).call(this),function(){!function(a){var b,c,d,e;return d=["bid","ask","last","high","low","vwap","volume","timestamp"],b=["AUD","BRL","CAD","CHF","CNY","EUR","GBP","IDR","ILS","MXN","NOK","NZD","PLN","RON","RUB","SEK","SGD","USD","ZAR"],c=function(){function c(){}var d,e;return e=null,d=function(){function c(){this.url="https://api.bitcoinaverage.com/ticker/all",this.conversions={},this.lastLoadTime=null,this.delay=6e5,this.loading=!1}return c.prototype.loadConversions=function(c){var d,e,f,g,h;e=function(d){return function(e){var f,g,h,i;if(g=a.parseJSON(e.query.results.body)){for(d.basePrice=parseFloat(g.USD["24h_avg"]),h=0,i=b.length;i>h;h++)f=b[h],g[f]?g[f]["24h_avg"]&&(d.conversions[f]=d.basePrice/parseFloat(g[f]["24h_avg"])):console.error("Currency",f,"is no longer supplied by BitcoinAverage");d.lastLoadTime=new Date,"function"==typeof c&&c()}else console.error("server returned",e.query.results.body)}}(this),f=function(a){console.error(a)},d=function(a){return function(){a.loading=!1,setTimeout(function(){return a.loadConversions()},a.delay)}}(this),!this.loading&&(null===this.lastLoadTime||this.lastLoadTime-1+this.delay<=new Date)&&(this.loading=!0,g=encodeURI("select * from html where url="),h="http://query.yahooapis.com/v1/public/yql?q="+g+'"'+this.url+'"&format=json&callback=?',a.getJSON(h).done(e).fail(f).always(d))},c}(),c.get=function(){return null!=e?e:e=new d},c}(),e=function(){function b(){}var c,d;return d=null,c=function(){function b(){this.url="https://www.bitstamp.net/api/ticker/",this.prices={btc:{}},this.lastLoadTime=null,this.delay=6e4,this.loading=!1}return b.prototype.loadPrices=function(){var b,c,d,e,f;c=function(b){return function(c){var d,e;try{c.query.results.body||(console.error("Missing API results for Bitstamp API."),console.debug("jsonp.query.results.body",c.query.results.body)),d=a.parseJSON(c.query.results.body),d?(b.prices.btc=d,b.lastLoadTime=new Date,a(document).trigger("price-change",[b.prices])):console.error("server returned",c.query.results.body)}catch(f){e=f,console.error("Caught error",e)}}}(this),d=function(a){console.error("failed to loadPrices",a)},b=function(a){return function(){a.loading=!1,setTimeout(function(){return a.loadPrices()},a.delay)}}(this),!this.loading&&(null===this.lastLoadTime||this.lastLoadTime-1+this.delay<=new Date)&&(this.loading=!0,e=encodeURI("select * from html where url="),f="http://query.yahooapis.com/v1/public/yql?q="+e+'"'+this.url+'"&format=json&callback=?',a.getJSON(f).done(c).fail(d).always(b))},b}(),b.get=function(){return null!=d?d:d=new c},b}(),a.fn.bitstampCurrentPrices=function(b){var f;return null==b&&(b="AUD"),this.converter=c.get(),this.converter.loadConversions(function(a){return function(){return a.loader=e.get(),a.loader.loadPrices()}}(this)),f=this,this.each(function(){var c,e,g,h,i,j,k,l,m;if(e=a(this),l=e.is("input[type=text]"),g="btc",c=(h=e.data("fiat"))?h:b,j=e.data("price"),-1===d.indexOf(j))throw"invalid price field";return k=(i=e.data("margin"))?parseFloat(i):1,m=function(a){l?e.val(a):e.text(a)},a(document).on("price-change",function(b,d){var e,h,i;"volume"===j||"timestamp"===j?(e="volume"===j?parseInt(d[g][j]).toString():(i=new Date(1e3*parseInt(d[g][j])).toISOString(),a.localtime?a.localtime.toLocalTime(i,"dd MMM yyyy 'at' hh:mm:ss a"):i),m(e)):f.converter.conversions[c]?(h=parseFloat(d[g][j])*k/f.converter.conversions[c],m(h.toFixed(2))):m("err")}),e})}}(jQuery)}.call(this);
//# sourceMappingURL=jquery-bitstampCurrentPrices.0.4.0.min.js.map